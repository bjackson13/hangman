version: "3.5"
services:
    nginx:
      image: nginx:latest
      container_name: proxy
      volumes:
        - ./proxy/reverse-proxy.conf:/etc/nginx/conf.d/default.conf
      ports:
        - "80:80"
        - "443:443"
      depends_on: 
        - app
      links: 
        - app
      restart: always

    app:
      build: .
      container_name: hangman
      links: 
        - db
      depends_on: 
        - db
      restart: always

    db:
      image: mysql:8.0.22
      container_name: mysqlDB
      environment:
          MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
          MYSQL_USER: ${MYSQL_USER}
          MYSQL_PASSWORD: ${MYSQL_PASSWORD}
          MYSQL_DATABASE: ${MYSQL_DB}
      command: --init-file /data/application/init.sql
      volumes:
          - ./sql/sqlschema.sql:/data/application/init.sql
          - db_data:/var/lib/mysql
      restart: always

volumes:
    db_data: